<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>koa-router Router源码分析 | 云的空间</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="koa-router" />
    
    <meta name="description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta name="keywords" content="koa-router">
<meta property="og:type" content="article">
<meta property="og:title" content="koa-router Router源码分析">
<meta property="og:url" content="https://xiangwenhu.github.io/2017/08/22/sourecode/koa-router-router/index.html">
<meta property="og:site_name" content="云的空间">
<meta property="og:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-08-23T08:42:25.594Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="koa-router Router源码分析">
<meta name="twitter:description" content="12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697989910010110210">
    

    

    

    <link rel="stylesheet" href="/blog/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/blog/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/blog/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/blog/css/style.css">

    <script src="/blog/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/blog/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/blog/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/blog/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle" style="line-height:80px">随笔，日记，博客，学习等集合体，打开它，总有收获</p>
                            <p class="subtitle" style="line-height:30px;text-align:left;font-style:normal">
                                <span id="busuanzi_container_site_pv">
                                    总访问量<span id="busuanzi_value_site_pv" style="color:bisque">-</span>次
                                </span>
                                <span id="busuanzi_container_site_uv">
                                    访客数<span id="busuanzi_value_site_uv" style="color:bisque">-</span>人次
                                  </span>
                            </p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/blog/">主页</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/blog/categories/其他/">其他</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/blog/categories/其他/github/">github</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/blog/categories/其他/浏览器/">浏览器</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/blog/categories/其他/网络/">网络</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/blog/categories/其他/资源/">资源</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/blog/categories/源码/">源码</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/blog/about.html">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/blog/',
        CONTENT_URL: '/blog/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/blog/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/blog/categories/源码/">源码</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-sourecode/koa-router-router" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        koa-router Router源码分析
        </h1>
    

            </header>
         
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/blog/2017/08/22/sourecode/koa-router-router/" class="article-date">
            <time datetime="2017-08-22T14:00:00.000Z" itemprop="datePublished">2017-08-22</time>
        </a>
    </div>

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/blog/tags/koa-router/">koa-router</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * RESTful resource routing middleware for koa.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @author Alex Mingoia &lt;talk@alexmingoia.com&gt;</span></div><div class="line"><span class="comment"> * @link https://github.com/alexmingoia/koa-router</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> debug = <span class="built_in">require</span>(<span class="string">'debug'</span>)(<span class="string">'koa-router'</span>);</div><div class="line"><span class="keyword">var</span> compose = <span class="built_in">require</span>(<span class="string">'koa-compose'</span>);</div><div class="line"><span class="keyword">var</span> HttpError = <span class="built_in">require</span>(<span class="string">'http-errors'</span>);</div><div class="line"><span class="keyword">var</span> methods = <span class="built_in">require</span>(<span class="string">'methods'</span>);</div><div class="line"><span class="keyword">var</span> Layer = <span class="built_in">require</span>(<span class="string">'./layer'</span>);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * @module koa-router</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = Router;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Create a new router.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Basic usage:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * var Koa = require('koa');</span></div><div class="line"><span class="comment"> * var Router = require('koa-router');</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * var app = new Koa();</span></div><div class="line"><span class="comment"> * var router = new Router();</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * router.get('/', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *   // ctx.router available</span></div><div class="line"><span class="comment"> * &#125;);</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * app</span></div><div class="line"><span class="comment"> *   .use(router.routes())</span></div><div class="line"><span class="comment"> *   .use(router.allowedMethods());</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @alias module:koa-router</span></div><div class="line"><span class="comment"> * @param &#123;Object=&#125; opts</span></div><div class="line"><span class="comment"> * @param &#123;String=&#125; opts.prefix prefix router paths</span></div><div class="line"><span class="comment"> * @constructor</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Router</span>(<span class="params">opts</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> Router)) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Router(opts);</div><div class="line">  &#125;</div><div class="line">  <span class="comment">// opts.prefix 前缀</span></div><div class="line">  <span class="comment">// opts.sensitive 带小写敏感,用于Layer的path-to-regexp 插件使用</span></div><div class="line">  <span class="comment">// opts.strict 末尾斜杠是否精确匹配,用于Layer的path-to-regexp 插件使用 </span></div><div class="line">  <span class="comment">// opts.methods 支持的方法</span></div><div class="line">  <span class="keyword">this</span>.opts = opts || &#123;&#125;;</div><div class="line">  <span class="keyword">this</span>.methods = <span class="keyword">this</span>.opts.methods || [</div><div class="line">    <span class="string">'HEAD'</span>,</div><div class="line">    <span class="string">'OPTIONS'</span>,</div><div class="line">    <span class="string">'GET'</span>,</div><div class="line">    <span class="string">'PUT'</span>,</div><div class="line">    <span class="string">'PATCH'</span>,</div><div class="line">    <span class="string">'POST'</span>,</div><div class="line">    <span class="string">'DELETE'</span></div><div class="line">  ];</div><div class="line"></div><div class="line">  <span class="comment">// 参数验证中间件</span></div><div class="line">  <span class="keyword">this</span>.params = &#123;&#125;;</div><div class="line">  <span class="comment">// Layer, 路由</span></div><div class="line">  <span class="keyword">this</span>.stack = [];</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Create `router.verb()` methods, where *verb* is one of the HTTP verbs such</span></div><div class="line"><span class="comment"> * as `router.get()` or `router.post()`.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Match URL patterns to callback functions or controller actions using `router.verb()`,</span></div><div class="line"><span class="comment"> * where **verb** is one of the HTTP verbs such as `router.get()` or `router.post()`.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Additionaly, `router.all()` can be used to match against all methods.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router</span></div><div class="line"><span class="comment"> *   .get('/', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     ctx.body = 'Hello World!';</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   .post('/users', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     // ...</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   .put('/users/:id', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     // ...</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   .del('/users/:id', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     // ...</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   .all('/users/:id', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     // ...</span></div><div class="line"><span class="comment"> *   &#125;);</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * When a route is matched, its path is available at `ctx._matchedRoute` and if named,</span></div><div class="line"><span class="comment"> * the name is available at `ctx._matchedRouteName`</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Route paths will be translated to regular expressions using</span></div><div class="line"><span class="comment"> * [path-to-regexp](https://github.com/pillarjs/path-to-regexp).</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Query strings will not be considered when matching requests.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * #### Named routes</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Routes can optionally have names. This allows generation of URLs and easy</span></div><div class="line"><span class="comment"> * renaming of URLs during development.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.get('user', '/users/:id', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *  // ...</span></div><div class="line"><span class="comment"> * &#125;);</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * router.url('user', 3);</span></div><div class="line"><span class="comment"> * // =&gt; "/users/3"</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * #### Multiple middleware</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Multiple middleware may be given:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.get(</span></div><div class="line"><span class="comment"> *   '/users/:id',</span></div><div class="line"><span class="comment"> *   function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     return User.findOne(ctx.params.id).then(function(user) &#123;</span></div><div class="line"><span class="comment"> *       ctx.user = user;</span></div><div class="line"><span class="comment"> *       next();</span></div><div class="line"><span class="comment"> *     &#125;);</span></div><div class="line"><span class="comment"> *   &#125;,</span></div><div class="line"><span class="comment"> *   function (ctx) &#123;</span></div><div class="line"><span class="comment"> *     console.log(ctx.user);</span></div><div class="line"><span class="comment"> *     // =&gt; &#123; id: 17, name: "Alex" &#125;</span></div><div class="line"><span class="comment"> *   &#125;</span></div><div class="line"><span class="comment"> * );</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ### Nested routers</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Nesting routers is supported:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * var forums = new Router();</span></div><div class="line"><span class="comment"> * var posts = new Router();</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * posts.get('/', function (ctx, next) &#123;...&#125;);</span></div><div class="line"><span class="comment"> * posts.get('/:pid', function (ctx, next) &#123;...&#125;);</span></div><div class="line"><span class="comment"> * forums.use('/forums/:fid/posts', posts.routes(), posts.allowedMethods());</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * // responds to "/forums/123/posts" and "/forums/123/posts/123"</span></div><div class="line"><span class="comment"> * app.use(forums.routes());</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * #### Router prefixes</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Route paths can be prefixed at the router level:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * var router = new Router(&#123;</span></div><div class="line"><span class="comment"> *   prefix: '/users'</span></div><div class="line"><span class="comment"> * &#125;);</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * router.get('/', ...); // responds to "/users"</span></div><div class="line"><span class="comment"> * router.get('/:id', ...); // responds to "/users/:id"</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * #### URL parameters</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Named route parameters are captured and added to `ctx.params`.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.get('/:category/:title', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *   console.log(ctx.params);</span></div><div class="line"><span class="comment"> *   // =&gt; &#123; category: 'programming', title: 'how-to-node' &#125;</span></div><div class="line"><span class="comment"> * &#125;);</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * The [path-to-regexp](https://github.com/pillarjs/path-to-regexp) module is</span></div><div class="line"><span class="comment"> * used to convert paths to regular expressions.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @name get|put|post|patch|delete|del</span></div><div class="line"><span class="comment"> * @memberof module:koa-router.prototype</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; path</span></div><div class="line"><span class="comment"> * @param &#123;Function=&#125; middleware route middleware(s)</span></div><div class="line"><span class="comment"> * @param &#123;Function&#125; callback route callback</span></div><div class="line"><span class="comment"> * @returns &#123;Router&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">// 注册注册路由的方法 router.get,router.post ......</span></div><div class="line">methods.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">method</span>) </span>&#123;</div><div class="line">  Router.prototype[method] = <span class="function"><span class="keyword">function</span> (<span class="params">name, path, middleware</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> middleware;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">'string'</span> || path <span class="keyword">instanceof</span> <span class="built_in">RegExp</span>) &#123;</div><div class="line">      middleware = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">2</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      middleware = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">      path = name;</div><div class="line">      name = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.register(path, [method], middleware, &#123;</div><div class="line">      name: name</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Alias for `router.delete()` because delete is a reserved word</span></div><div class="line">Router.prototype.del = Router.prototype[<span class="string">'delete'</span>];</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Use given middleware.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Middleware run in the order they are defined by `.use()`. They are invoked</span></div><div class="line"><span class="comment"> * sequentially, requests start at the first middleware and work their way</span></div><div class="line"><span class="comment"> * "down" the middleware stack.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * // session middleware will run before authorize</span></div><div class="line"><span class="comment"> * router</span></div><div class="line"><span class="comment"> *   .use(session())</span></div><div class="line"><span class="comment"> *   .use(authorize());</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * // use middleware only with given path</span></div><div class="line"><span class="comment"> * router.use('/users', userAuth());</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * // or with an array of paths</span></div><div class="line"><span class="comment"> * router.use(['/users', '/admin'], userAuth());</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * app.use(router.routes());</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String=&#125; path</span></div><div class="line"><span class="comment"> * @param &#123;Function&#125; middleware</span></div><div class="line"><span class="comment"> * @param &#123;Function=&#125; ...</span></div><div class="line"><span class="comment"> * @returns &#123;Router&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="comment">// 注册路由中间件</span></div><div class="line">Router.prototype.use = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> router = <span class="keyword">this</span>;</div><div class="line">  <span class="keyword">var</span> middleware = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</div><div class="line">  <span class="keyword">var</span> path = <span class="string">'(.*)'</span>;</div><div class="line"></div><div class="line">  <span class="comment">// support array of paths</span></div><div class="line">  <span class="comment">// 如果是数组，router.use(['/users', '/admin'],middleware1,middleware2) </span></div><div class="line">  <span class="comment">// 对'/users','/admin' 依次调用 router.use(path,middleware,middleware2)</span></div><div class="line">  <span class="comment">// 简单的说就是专为单路由调用</span></div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(middleware[<span class="number">0</span>]) &amp;&amp; <span class="keyword">typeof</span> middleware[<span class="number">0</span>][<span class="number">0</span>] === <span class="string">'string'</span>) &#123;</div><div class="line">    middleware[<span class="number">0</span>].forEach(<span class="function"><span class="keyword">function</span> (<span class="params">p</span>) </span>&#123;</div><div class="line">      router.use.apply(router, [p].concat(middleware.slice(<span class="number">1</span>)));</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">//如果第一个是path，弹出path </span></div><div class="line">  <span class="keyword">var</span> hasPath = <span class="keyword">typeof</span> middleware[<span class="number">0</span>] === <span class="string">'string'</span>;</div><div class="line">  <span class="keyword">if</span> (hasPath) &#123;</div><div class="line">    path = middleware.shift();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  middleware.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">m</span>) </span>&#123;</div><div class="line">    <span class="comment">// 如果有router,表明是router.routes()返回的中间件,</span></div><div class="line">    <span class="comment">// 调用形式大致如 parentRouter.use('/parent-route',  nestedRouter.routes())</span></div><div class="line">    <span class="keyword">if</span> (m.router) &#123;</div><div class="line">      m.router.stack.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">nestedLayer</span>) </span>&#123;</div><div class="line">        <span class="comment">// 子路由的前缀</span></div><div class="line">        <span class="keyword">if</span> (path) nestedLayer.setPrefix(path);  </div><div class="line">        <span class="comment">// 父路由的前缀，因为parentRouter本身可能有前缀</span></div><div class="line">        <span class="keyword">if</span> (router.opts.prefix) nestedLayer.setPrefix(router.opts.prefix);</div><div class="line">        <span class="comment">// router.stack存一份更新后的路由引用</span></div><div class="line">        router.stack.push(nestedLayer);</div><div class="line">      &#125;);</div><div class="line">      <span class="comment">// 参数验证中间件添加给 m.router 来一份</span></div><div class="line">      <span class="keyword">if</span> (router.params) &#123;</div><div class="line">        <span class="comment">// 参数验证中间件添加给 m.router 来一份</span></div><div class="line">        <span class="comment">// 保证在调用子路由的时候，也验证参数,看看param方法，实际上是Router实例把参数验证中间件传给每一个路由(Layer)</span></div><div class="line">        <span class="comment">// m.router.stack就是存放路由(Layer)的数组</span></div><div class="line">        <span class="comment">//Router.prototype.param = function (param, middleware) &#123;</span></div><div class="line">        <span class="comment">//  this.params[param] = middleware;</span></div><div class="line">        <span class="comment">//  this.stack.forEach(function (route) &#123;</span></div><div class="line">        <span class="comment">//    route.param(param, middleware);</span></div><div class="line">        <span class="comment">//  &#125;);</span></div><div class="line">        <span class="comment">//  return this;</span></div><div class="line">        <span class="comment">//&#125;;   </span></div><div class="line">        <span class="built_in">Object</span>.keys(router.params).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123;</div><div class="line">          m.router.param(key, router.params[key]);</div><div class="line">        &#125;);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="comment">// 如果不是路由中间件,注册新的中间件</span></div><div class="line">      router.register(path, [], m, &#123; <span class="attr">end</span>: <span class="literal">false</span>, <span class="attr">ignoreCaptures</span>: !hasPath &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Set the path prefix for a Router instance that was already initialized.</span></div><div class="line"><span class="comment"> * 给router实例添加前缀</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.prefix('/things/:thing_id')</span></div><div class="line"><span class="comment"> * ```     </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; prefix</span></div><div class="line"><span class="comment"> * @returns &#123;Router&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.prefix = <span class="function"><span class="keyword">function</span> (<span class="params">prefix</span>) </span>&#123;</div><div class="line">  prefix = prefix.replace(<span class="regexp">/\/$/</span>, <span class="string">''</span>);</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.opts.prefix = prefix;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.stack.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">route</span>) </span>&#123;</div><div class="line">    route.setPrefix(prefix);</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Returns router middleware which dispatches a route matching the request.</span></div><div class="line"><span class="comment"> * 生成路由中间件</span></div><div class="line"><span class="comment"> * @returns &#123;Function&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.routes = Router.prototype.middleware = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> router = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> dispatch = <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">ctx, next</span>) </span>&#123;</div><div class="line">    debug(<span class="string">'%s %s'</span>, ctx.method, ctx.path);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> path = router.opts.routerPath || ctx.routerPath || ctx.path;</div><div class="line">    <span class="keyword">var</span> matched = router.match(path, ctx.method);</div><div class="line">    <span class="keyword">var</span> layerChain, layer, i;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (ctx.matched) &#123;</div><div class="line">      <span class="comment">// 多个router有match上</span></div><div class="line">      ctx.matched.push.apply(ctx.matched, matched.path);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      ctx.matched = matched.path;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// router指向当前router</span></div><div class="line">    ctx.router = router;</div><div class="line">    <span class="comment">// 没匹配，下一个中间件</span></div><div class="line">    <span class="keyword">if</span> (!matched.route) <span class="keyword">return</span> next();</div><div class="line"></div><div class="line">    <span class="keyword">var</span> matchedLayers = matched.pathAndMethod</div><div class="line">    <span class="keyword">var</span> mostSpecificLayer = matchedLayers[matchedLayers.length - <span class="number">1</span>]</div><div class="line">    ctx._matchedRoute = mostSpecificLayer.path;</div><div class="line">    <span class="keyword">if</span> (mostSpecificLayer.name) &#123;</div><div class="line">      ctx._matchedRouteName = mostSpecificLayer.name;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 添加参数中间件，一个变两，</span></div><div class="line">    layerChain = matchedLayers.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">memo, layer</span>) </span>&#123;</div><div class="line">      <span class="comment">// 解析参数和参数值</span></div><div class="line">      memo.push(<span class="function"><span class="keyword">function</span>(<span class="params">ctx, next</span>) </span>&#123;</div><div class="line">        ctx.captures = layer.captures(path, ctx.captures);</div><div class="line">        <span class="comment">// 参数会叠加，比如 '/user/:id' '/user/:id/post/:pid'</span></div><div class="line">        <span class="comment">// id和pid的值都会被映射到 ctx.params上  </span></div><div class="line">        <span class="comment">// 有人会说，我一般ctx.body就完事了，你试试修改router的匹配规则和和调用next()试// 试就知道了</span></div><div class="line">        ctx.params = layer.params(path, ctx.captures, ctx.params);</div><div class="line">        <span class="keyword">return</span> next();</div><div class="line">      &#125;);</div><div class="line">      <span class="keyword">return</span> memo.concat(layer.stack);</div><div class="line">    &#125;, []);</div><div class="line"></div><div class="line">    <span class="comment">//执行</span></div><div class="line">    <span class="keyword">return</span> compose(layerChain)(ctx, next);</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="comment">// 保存对router的引用，在use里面也用来是被是不是路由中间件</span></div><div class="line">  dispatch.router = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> dispatch;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Returns separate middleware for responding to `OPTIONS` requests with</span></div><div class="line"><span class="comment"> * an `Allow` header containing the allowed methods, as well as responding</span></div><div class="line"><span class="comment"> * with `405 Method Not Allowed` and `501 Not Implemented` as appropriate.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * var Koa = require('koa');</span></div><div class="line"><span class="comment"> * var Router = require('koa-router');</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * var app = new Koa();</span></div><div class="line"><span class="comment"> * var router = new Router();</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * app.use(router.routes());</span></div><div class="line"><span class="comment"> * app.use(router.allowedMethods());</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * **Example with [Boom](https://github.com/hapijs/boom)**</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * var Koa = require('koa');</span></div><div class="line"><span class="comment"> * var Router = require('koa-router');</span></div><div class="line"><span class="comment"> * var Boom = require('boom');</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * var app = new Koa();</span></div><div class="line"><span class="comment"> * var router = new Router();</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * app.use(router.routes());</span></div><div class="line"><span class="comment"> * app.use(router.allowedMethods(&#123;</span></div><div class="line"><span class="comment"> *   throw: true,</span></div><div class="line"><span class="comment"> *   notImplemented: () =&gt; new Boom.notImplemented(),</span></div><div class="line"><span class="comment"> *   methodNotAllowed: () =&gt; new Boom.methodNotAllowed()</span></div><div class="line"><span class="comment"> * &#125;));</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;Object=&#125; options</span></div><div class="line"><span class="comment"> * @param &#123;Boolean=&#125; options.throw throw error instead of setting status and header</span></div><div class="line"><span class="comment"> * @param &#123;Function=&#125; options.notImplemented throw the returned value in place of the default NotImplemented error</span></div><div class="line"><span class="comment"> * @param &#123;Function=&#125; options.methodNotAllowed throw the returned value in place of the default MethodNotAllowed error</span></div><div class="line"><span class="comment"> * @returns &#123;Function&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.allowedMethods = <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</div><div class="line">  options = options || &#123;&#125;;</div><div class="line">  <span class="keyword">var</span> implemented = <span class="keyword">this</span>.methods;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">allowedMethods</span>(<span class="params">ctx, next</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> next().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> allowed = &#123;&#125;;</div><div class="line">       </div><div class="line">      <span class="comment">// 获得所有支持的方法</span></div><div class="line">      <span class="keyword">if</span> (!ctx.status || ctx.status === <span class="number">404</span>) &#123;</div><div class="line">        ctx.matched.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">route</span>) </span>&#123;</div><div class="line">          route.methods.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">method</span>) </span>&#123;</div><div class="line">            allowed[method] = method;</div><div class="line">          &#125;);</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        <span class="keyword">var</span> allowedArr = <span class="built_in">Object</span>.keys(allowed);</div><div class="line">        <span class="comment">//未实现</span></div><div class="line">        <span class="keyword">if</span> (!~implemented.indexOf(ctx.method)) &#123;</div><div class="line">          <span class="keyword">if</span> (options.throw) &#123;</div><div class="line">            <span class="keyword">var</span> notImplementedThrowable;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> options.notImplemented === <span class="string">'function'</span>) &#123;</div><div class="line">              notImplementedThrowable = options.notImplemented(); <span class="comment">// set whatever the user returns from their function</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              notImplementedThrowable = <span class="keyword">new</span> HttpError.NotImplemented();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">throw</span> notImplementedThrowable;</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">            ctx.status = <span class="number">501</span>;</div><div class="line">            ctx.set(<span class="string">'Allow'</span>, allowedArr);</div><div class="line">          &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (allowedArr.length) &#123; <span class="comment">// 如果length &gt; 0表示有路由匹配</span></div><div class="line">          <span class="keyword">if</span> (ctx.method === <span class="string">'OPTIONS'</span>) &#123;</div><div class="line">            ctx.status = <span class="number">200</span>;</div><div class="line">            ctx.body = <span class="string">''</span>;</div><div class="line">            ctx.set(<span class="string">'Allow'</span>, allowedArr);</div><div class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!allowed[ctx.method]) &#123; <span class="comment">//对应请求方式不被允许，比如post请求只定义了get方法的路由</span></div><div class="line">            <span class="keyword">if</span> (options.throw) &#123;</div><div class="line">              <span class="keyword">var</span> notAllowedThrowable;</div><div class="line">              <span class="keyword">if</span> (<span class="keyword">typeof</span> options.methodNotAllowed === <span class="string">'function'</span>) &#123;</div><div class="line">                notAllowedThrowable = options.methodNotAllowed(); <span class="comment">// set whatever the user returns from their function</span></div><div class="line">              &#125; <span class="keyword">else</span> &#123;</div><div class="line">                notAllowedThrowable = <span class="keyword">new</span> HttpError.MethodNotAllowed();</div><div class="line">              &#125;</div><div class="line">              <span class="keyword">throw</span> notAllowedThrowable;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">              ctx.status = <span class="number">405</span>;</div><div class="line">              ctx.set(<span class="string">'Allow'</span>, allowedArr);</div><div class="line">            &#125;</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Register route with all methods.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; name Optional.</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; path</span></div><div class="line"><span class="comment"> * @param &#123;Function=&#125; middleware You may also pass multiple middleware.</span></div><div class="line"><span class="comment"> * @param &#123;Function&#125; callback</span></div><div class="line"><span class="comment"> * @returns &#123;Router&#125;</span></div><div class="line"><span class="comment"> * @private</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.all = <span class="function"><span class="keyword">function</span> (<span class="params">name, path, middleware</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> middleware;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> path === <span class="string">'string'</span>) &#123;</div><div class="line">    middleware = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">2</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    middleware = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">    path = name;</div><div class="line">    name = <span class="literal">null</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.register(path, methods, middleware, &#123;</div><div class="line">    name: name</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Redirect `source` to `destination` URL with optional 30x status `code`.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * Both `source` and `destination` can be route names.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.redirect('/login', 'sign-in');</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This is equivalent to:</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.all('/login', function (ctx) &#123;</span></div><div class="line"><span class="comment"> *   ctx.redirect('/sign-in');</span></div><div class="line"><span class="comment"> *   ctx.status = 301;</span></div><div class="line"><span class="comment"> * &#125;);</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; source URL or route name.</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; destination URL or route name.</span></div><div class="line"><span class="comment"> * @param &#123;Number&#125; code HTTP status code (default: 301).</span></div><div class="line"><span class="comment"> * @returns &#123;Router&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.redirect = <span class="function"><span class="keyword">function</span> (<span class="params">source, destination, code</span>) </span>&#123;</div><div class="line">  <span class="comment">// lookup source route by name</span></div><div class="line">  <span class="keyword">if</span> (source[<span class="number">0</span>] !== <span class="string">'/'</span>) &#123;</div><div class="line">    source = <span class="keyword">this</span>.url(source);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// lookup destination route by name</span></div><div class="line">  <span class="keyword">if</span> (destination[<span class="number">0</span>] !== <span class="string">'/'</span>) &#123;</div><div class="line">    destination = <span class="keyword">this</span>.url(destination);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.all(source, <span class="function"><span class="keyword">function</span> (<span class="params">ctx</span>) </span>&#123;</div><div class="line">    ctx.redirect(destination);</div><div class="line">    ctx.status = code || <span class="number">301</span>;</div><div class="line">  &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Create and register a route.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; path Path string.</span></div><div class="line"><span class="comment"> * @param &#123;Array.&lt;String&gt;&#125; methods Array of HTTP verbs.</span></div><div class="line"><span class="comment"> * @param &#123;Function&#125; middleware Multiple middleware also accepted.</span></div><div class="line"><span class="comment"> * @returns &#123;Layer&#125;</span></div><div class="line"><span class="comment"> * @private</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.register = <span class="function"><span class="keyword">function</span> (<span class="params">path, methods, middleware, opts</span>) </span>&#123;</div><div class="line">  opts = opts || &#123;&#125;;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> router = <span class="keyword">this</span>;</div><div class="line">  <span class="keyword">var</span> stack = <span class="keyword">this</span>.stack;</div><div class="line"></div><div class="line">  <span class="comment">// support array of paths</span></div><div class="line">  <span class="comment">// 数组挨个调用register</span></div><div class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(path)) &#123;</div><div class="line">    path.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">p</span>) </span>&#123;</div><div class="line">      router.register.call(router, p, methods, middleware, opts);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// create route</span></div><div class="line">  <span class="keyword">var</span> route = <span class="keyword">new</span> Layer(path, methods, middleware, &#123;</div><div class="line">    end: opts.end === <span class="literal">false</span> ? opts.end : <span class="literal">true</span>,</div><div class="line">    name: opts.name,</div><div class="line">    sensitive: opts.sensitive || <span class="keyword">this</span>.opts.sensitive || <span class="literal">false</span>,</div><div class="line">    strict: opts.strict || <span class="keyword">this</span>.opts.strict || <span class="literal">false</span>,</div><div class="line">    prefix: opts.prefix || <span class="keyword">this</span>.opts.prefix || <span class="string">""</span>,</div><div class="line">    ignoreCaptures: opts.ignoreCaptures</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.opts.prefix) &#123;</div><div class="line">    route.setPrefix(<span class="keyword">this</span>.opts.prefix);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// add parameter middleware</span></div><div class="line">  <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.params).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">param</span>) </span>&#123;</div><div class="line">    route.param(param, <span class="keyword">this</span>.params[param]);</div><div class="line">  &#125;, <span class="keyword">this</span>);</div><div class="line"></div><div class="line">  stack.push(route);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> route;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Lookup route with given `name`.</span></div><div class="line"><span class="comment"> * 查找具名的route</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; name</span></div><div class="line"><span class="comment"> * @returns &#123;Layer|false&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.route = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> routes = <span class="keyword">this</span>.stack;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> len = routes.length, i=<span class="number">0</span>; i&lt;len; i++) &#123;</div><div class="line">    <span class="keyword">if</span> (routes[i].name &amp;&amp; routes[i].name === name) &#123;</div><div class="line">      <span class="keyword">return</span> routes[i];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Generate URL for route. Takes a route name and map of named `params`.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router.get('user', '/users/:id', function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *   // ...</span></div><div class="line"><span class="comment"> * &#125;);</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * router.url('user', 3);</span></div><div class="line"><span class="comment"> * // =&gt; "/users/3"</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * router.url('user', &#123; id: 3 &#125;);</span></div><div class="line"><span class="comment"> * // =&gt; "/users/3"</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * router.use(function (ctx, next) &#123;</span></div><div class="line"><span class="comment"> *   // redirect to named route</span></div><div class="line"><span class="comment"> *   ctx.redirect(ctx.router.url('sign-in'));</span></div><div class="line"><span class="comment"> * &#125;)</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; name route name</span></div><div class="line"><span class="comment"> * @param &#123;Object&#125; params url parameters</span></div><div class="line"><span class="comment"> * @returns &#123;String|Error&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.url = <span class="function"><span class="keyword">function</span> (<span class="params">name, params</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> route = <span class="keyword">this</span>.route(name);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (route) &#123;</div><div class="line">    <span class="keyword">var</span> args = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">    <span class="keyword">return</span> route.url.apply(route, args);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"No route found for name: "</span> + name);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Match given `path` and return corresponding routes.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; path</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; method</span></div><div class="line"><span class="comment"> * @returns &#123;Object.&lt;path, pathAndMethod&gt;&#125; returns layers that matched path and</span></div><div class="line"><span class="comment"> * path and method.</span></div><div class="line"><span class="comment"> * @private</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.match = <span class="function"><span class="keyword">function</span> (<span class="params">path, method</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> layers = <span class="keyword">this</span>.stack;</div><div class="line">  <span class="keyword">var</span> layer;</div><div class="line">  <span class="keyword">var</span> matched = &#123;</div><div class="line">    path: [],</div><div class="line">    pathAndMethod: [],</div><div class="line">    route: <span class="literal">false</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> len = layers.length, i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">    layer = layers[i];</div><div class="line"></div><div class="line">    debug(<span class="string">'test %s %s'</span>, layer.path, layer.regexp);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (layer.match(path)) &#123;</div><div class="line">      matched.path.push(layer);</div><div class="line">      <span class="comment">// layer 未指定methods，相当于any,或者包含该方法  ~ 取反值，并-1，只有 -1时 ~-1 === 0</span></div><div class="line">      <span class="keyword">if</span> (layer.methods.length === <span class="number">0</span> || ~layer.methods.indexOf(method)) &#123;</div><div class="line">        matched.pathAndMethod.push(layer);</div><div class="line">        <span class="keyword">if</span> (layer.methods.length) matched.route = <span class="literal">true</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> matched;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Run middleware for named route parameters. Useful for auto-loading or</span></div><div class="line"><span class="comment"> * validation.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * router</span></div><div class="line"><span class="comment"> *   .param('user', function (id, ctx, next) &#123;</span></div><div class="line"><span class="comment"> *     ctx.user = users[id];</span></div><div class="line"><span class="comment"> *     if (!ctx.user) return ctx.status = 404;</span></div><div class="line"><span class="comment"> *     return next();</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   .get('/users/:user', function (ctx) &#123;</span></div><div class="line"><span class="comment"> *     ctx.body = ctx.user;</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   .get('/users/:user/friends', function (ctx) &#123;</span></div><div class="line"><span class="comment"> *     return ctx.user.getFriends().then(function(friends) &#123;</span></div><div class="line"><span class="comment"> *       ctx.body = friends;</span></div><div class="line"><span class="comment"> *     &#125;);</span></div><div class="line"><span class="comment"> *   &#125;)</span></div><div class="line"><span class="comment"> *   // /users/3 =&gt; &#123;"id": 3, "name": "Alex"&#125;</span></div><div class="line"><span class="comment"> *   // /users/3/friends =&gt; [&#123;"id": 4, "name": "TJ"&#125;]</span></div><div class="line"><span class="comment"> * ```    </span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @param &#123;String&#125; param</span></div><div class="line"><span class="comment"> * @param &#123;Function&#125; middleware</span></div><div class="line"><span class="comment"> * @returns &#123;Router&#125;</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line">Router.prototype.param = <span class="function"><span class="keyword">function</span> (<span class="params">param, middleware</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.params[param] = middleware;</div><div class="line">  <span class="keyword">this</span>.stack.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">route</span>) </span>&#123;</div><div class="line">    route.param(param, middleware);</div><div class="line">  &#125;);</div><div class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Generate URL from url pattern and given `params`.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * @example</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * ```javascript</span></div><div class="line"><span class="comment"> * var url = Router.url('/users/:id', &#123;id: 1&#125;);</span></div><div class="line"><span class="comment"> * =&gt; "/users/1"    </span></div><div class="line"><span class="comment"> *</span></div></pre></td></tr></table></figure>
<ul>
<li>@param {String} path url pattern</li>
<li>@param {Object} params url parameters</li>
<li>@returns {String}<br>*/<br>Router.url = function (path, params) {<br> return Layer.prototype.url.call({path: path}, params);<br>};<br>```</li>
</ul>

        </div>
        <footer class="article-footer">
            


    <div class="a2a_kit a2a_default_style">
    <a class="a2a_dd" href="https://www.addtoany.com/share">Share</a>
    <span class="a2a_divider"></span>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_google_plus"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_tumblr"></a>
</div>
<script type="text/javascript" src="//static.addtoany.com/menu/page.js"></script>
<style>
    .a2a_menu {
        border-radius: 4px;
    }
    .a2a_menu a {
        margin: 2px 0;
        font-size: 14px;
        line-height: 16px;
        border-radius: 4px;
        color: inherit !important;
        font-family: 'Microsoft Yahei';
    }
    #a2apage_dropdown {
        margin: 10px 0;
    }
    .a2a_mini_services {
        padding: 10px;
    }
    a.a2a_i,
    i.a2a_i {
        width: 122px;
        line-height: 16px;
    }
    a.a2a_i .a2a_svg,
    a.a2a_more .a2a_svg {
        width: 16px;
        height: 16px;
        line-height: 16px;
        vertical-align: top;
        background-size: 16px;
    }
    a.a2a_i {
        border: none !important;
    }
    a.a2a_menu_show_more_less {
        margin: 0;
        padding: 10px 0;
        line-height: 16px;
    }
    .a2a_mini_services:after{content:".";display:block;height:0;clear:both;visibility:hidden}
    .a2a_mini_services{*+height:1%;}
</style>


        </footer>
    </div>
</article>

    <section id="comments">
    
        <!-- 来必力City版安装代码 -->
<div id="lv-container" data-id="city" data-uid="MTAyMC8zMDQxMy82OTY3">
	<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
	</script>
<noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
</div>
<!-- City版安装代码已完成 -->
    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/xiangwenhu" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weixin" href="/blog/" target="_blank">
                        <i class="icon fa fa-weixin"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="qq" href="/blog/" target="_blank">
                        <i class="icon fa fa-qq"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/blog/2017/08/22/sourecode/koa-router/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            koa-router源码分析
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/blog/2017/08/22/sourecode/koa-router-layer/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">上一篇</strong>
        <p class="article-nav-title">koa-router Layer源码分析</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/源码/">源码</a></p>
                            <p class="item-title"><a href="/blog/2017/08/22/sourecode/koa-router/" class="title">koa-router源码分析</a></p>
                            <p class="item-date"><time datetime="2017-08-22T15:00:00.000Z" itemprop="datePublished">2017-08-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/源码/">源码</a></p>
                            <p class="item-title"><a href="/blog/2017/08/22/sourecode/koa-router-router/" class="title">koa-router Router源码分析</a></p>
                            <p class="item-date"><time datetime="2017-08-22T14:00:00.000Z" itemprop="datePublished">2017-08-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/源码/">源码</a></p>
                            <p class="item-title"><a href="/blog/2017/08/22/sourecode/koa-router-layer/" class="title">koa-router Layer源码分析</a></p>
                            <p class="item-date"><time datetime="2017-08-22T14:00:00.000Z" itemprop="datePublished">2017-08-22</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/其他/">其他</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/blog/categories/其他/github/">github</a></p>
                            <p class="item-title"><a href="/blog/2017/08/19/other/blogwithhexo/" class="title">Hexo + Github搭建自己的博客</a></p>
                            <p class="item-date"><time datetime="2017-08-19T14:00:00.000Z" itemprop="datePublished">2017-08-19</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/blog/categories/其他/">其他</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/blog/categories/其他/资源/">资源</a></p>
                            <p class="item-title"><a href="/blog/2017/08/16/other/links/" class="title">一些链接</a></p>
                            <p class="item-date"><time datetime="2017-08-16T08:00:00.000Z" itemprop="datePublished">2017-08-16</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/其他/">其他</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/其他/github/">github</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/其他/浏览器/">浏览器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/其他/网络/">网络</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/其他/资源/">资源</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/源码/">源码</a><span class="category-list-count">6</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/08/">八月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2017/07/">七月 2017</a><span class="archive-list-count">3</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/github/">github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/koa/">koa</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/koa-router/">koa-router</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/前端/">前端</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/浏览器/">浏览器</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/网络/">网络</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/blog/tags/github/" style="font-size: 10px;">github</a> <a href="/blog/tags/koa/" style="font-size: 20px;">koa</a> <a href="/blog/tags/koa-router/" style="font-size: 20px;">koa-router</a> <a href="/blog/tags/前端/" style="font-size: 15px;">前端</a> <a href="/blog/tags/浏览器/" style="font-size: 10px;">浏览器</a> <a href="/blog/tags/网络/" style="font-size: 10px;">网络</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.cnblogs.com/cloud-/">cnblogs</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/blog/" class="logo"></a>
                </h1>
                <p>&copy; 2017 云</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        


    
        <script src="/blog/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/blog/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/blog/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/blog/js/main.js"></script>

    </div>
</body>
</html>
